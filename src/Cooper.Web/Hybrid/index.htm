<!DOCTYPE html>
<html>
<head>
    <title>Cooper:Task</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="themes/cooper.css" rel="stylesheet" type="text/css" />
    <link href="jquery/css/mobile/jquery.mobile.structure-1.1.1.min.css" rel="stylesheet" type="text/css" />
    <link href="css/base.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <script src="jquery/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="jquery/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>
    <script src="jquery/jqm.page.params.js" type="text/javascript"></script>
    <script src="scripts/cooper.js" type="text/javascript"></script>
    <script src="scripts/lang.js" type="text/javascript"></script>

    <!--全局-->
    <script type="text/javascript">
        var pageData = {}; //存放当前页面的参数信息
        $(document).bind("mobileinit", function () {
            $.mobile.page.prototype.options.domCache = true;
        });
        $(document).bind("pagebeforechange", function (e, data) {
            pageData = data.options.pageData;
        });
    </script>

    <!-- 登录页面 -->
    <div id="loginPage" data-role="page" data-theme="a">
        <div data-role="content">
            <div style="text-align: center;">
                <img src="images/cooper.png" width="250px" />
            </div>
            <form>
            <ul data-role="listview" data-inset="true">
                <li data-role="fieldcontain">
                    <input type="text" placeholder="账号" name="username" style="width: 100%" />
                </li>
                <li data-role="fieldcontain">
                    <input type="password" placeholder="密码" name="password" style="width: 100%" />
                </li>
            </ul>
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <div data-role="controlgroup">
                        <input type="checkbox" name="record" id="record" checked="checked" />
                        <label for="record">
                            记住登录</label>
                    </div>
                </div>
                <div class="ui-block-b" style="text-align: right">
                    <button id="loginButton" type="button" data-inline="true" data-theme="a">
                        登录</button>
                    <button type="button" data-inline="true">
                        跳过</button>
                </div>
            </div>
            </form>
        </div>
    </div>
    <!-- 任务列表页面 -->
    <div id="taskListPage" data-role="page" data-theme="a">
        <div data-role="header">
            <div class="ui-btn-left" style="line-height: 50px">
                <img id="addTaskListImg" src="images/edit.png" />
                &nbsp;
                <img id="refreshTaskListsImg" src="images/refresh.png" />
            </div>
            <h1>
                cooper:task</h1>
            <div class="ui-btn-right"><img src="images/setting.png" /></div>
        </div>
        <div data-role="content">
            <ul id="taskListUl" data-role="listview" data-inset="true" data-icon="star" data-theme="c"></ul>
        </div>
    </div>
    <!-- 任务页面 -->
    <div id="taskPage" data-role="page" data-theme="a">
        <div data-role="header" data-position="fixed">
            <div class="ui-btn-left" style="line-height: 50px">
                <img id="gotoTasklistImg" src="images/tasklist.png" />
                &nbsp;
                <img id="refreshTasksImg" src="images/refresh.png" />
            </div>
            <h1>
                cooper:task</h1>
            <div class="ui-btn-right" style="line-height: 50px">
                <img id="addTaskImg" src="images/edit.png" /></div>
        </div>
        <div data-role="content">
            <ul id="taskUl" data-role="listview" data-theme="c"></ul>
        </div>
        <div data-role="footer" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a>
                        <img src="images/task.png" />
                        <br />
                        个人任务</a></li>
                    <li><a>
                        <img src="images/complete.png" />
                        <br />
                        已完成</a></li>
                    <li><a>
                        <img src="images/incomplete.png" />
                        <br />
                        未完成</a></li>
                    <li><a>
                        <img src="images/setting-small.png" />
                        <br />
                        设置</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- 任务详情页面 -->
    <div id="taskDetailPage" data-role="page">
        <div data-role="header" data-position="fixed">
            <div class="ui-btn-left" style="line-height: 50px">
                <img id="gotoTaskPage" src="images/back.png" />
            </div>
            <h1>
                cooper:task</h1>
            <div class="ui-btn-right" style="line-height: 50px">
                <img id="gotoTaskEditPage" src="images/edit.png" /></div>
        </div>
        <div data-role="content" style="background-color: #fff">
            <div data-role="fieldcontain">
                <label for="isTaskCompleted">
                    是否完成</label>
                <select name="isTaskCompleted" id="isTaskCompleted" data-role="slider">
                    <option value="false">未完成</option>
                    <option value="true">完成</option>
                </select>
            </div>
            <div data-role="fieldcontain">
                <fieldset data-role="controlgroup" data-type="horizontal">
                    <legend>优先级</legend>
                    <input type="radio" name="taskPriority" id="radio-taskPriority-0" value="0" />
                    <label for="radio-taskPriority-0">
                        今天</label>
                    <input type="radio" name="taskPriority" id="radio-taskPriority-1" value="1" />
                    <label for="radio-taskPriority-1">
                        稍后</label>
                    <input type="radio" name="taskPriority" id="radio-taskPriority-2" value="2" />
                    <label for="radio-taskPriority-2">
                        迟些</label>
                </fieldset>
            </div>
            <div data-role="fieldcontain">
                <label for="taskDueTime">
                    截止日期</label>
                <input type="date" name="taskDueTime" id="taskDueTime" />
            </div>
            <div data-role="fieldcontain">
                <p id="taskSubject"></p>
                <p id="taskBody"></p>
            </div>
            <br />
            <ul data-role="listview" data-icon="star" data-inset="true">
                <li>
                    <h3>
                    </h3>
                    <p>
                        <strong>wsky 评论于 2012-7-8</strong></p>
                    <p>
                        Hey Stephen, if you're available at 10am tomorrow, we've got a meeting with the
                        jQuery team.
                    </p>
                </li>
                <li>
                    <h3>
                    </h3>
                    <p>
                        <strong>wsky 评论于 2012-7-8</strong></p>
                    <p>
                        Hey Stephen, if you're available at 10am tomorrow, we've got a meeting with the
                        jQuery team.
                    </p>
                </li>
                <li>
                    <h3>
                    </h3>
                    <p>
                        <strong>wsky 评论于 2012-7-8</strong></p>
                    <p>
                        Hey Stephen, if you're available at 10am tomorrow, we've got a meeting with the
                        jQuery team.
                    </p>
                </li>
            </ul>
        </div>
        <div data-role="footer" data-position="fixed" data-theme="a">
            <input type="text" placeholder="添加评论" />
        </div>
    </div>
    <!-- 任务新增编辑页面 -->
    <div id="taskEditPage" data-role="page">
        <div data-role="header" data-position="fixed">
            <div class="ui-btn-left" style="line-height: 50px">
                <img id="gotoTaskPageFromDetailPage" src="images/back.png" />
            </div>
            <h1>
                cooper:task</h1>
            <a id="addOrUpdateTaskButton" class="ui-btn-right" data-icon="check">确定</a>
        </div>
        <div data-role="content" style="background-color: #fff">
            <div data-role="fieldcontain">
                <label for="isCompleted">
                    是否完成</label>
                <select name="isCompleted" id="isCompleted" data-role="slider">
                    <option value="false">未完成</option>
                    <option value="true">完成</option>
                </select>
            </div>
            <div data-role="fieldcontain">
                <fieldset data-role="controlgroup" data-type="horizontal">
                    <legend>优先级</legend>
                    <input type="radio" name="priority" id="radio-priority-0" value="0" />
                    <label for="radio-priority-0">
                        今天</label>
                    <input type="radio" name="priority" id="radio-priority-1" value="1" />
                    <label for="radio-priority-1">
                        稍后</label>
                    <input type="radio" name="priority" id="radio-priority-2" value="2" />
                    <label for="radio-priority-2">
                        迟些</label>
                </fieldset>
            </div>
            <div data-role="fieldcontain">
                <label for="duetime">
                    截止日期</label>
                <input type="date" name="duetime" id="duetime" />
            </div>
            <div data-role="fieldcontain">
                <label for="subject">
                    标题</label>
                <input name="subject" id="subject" type="text" placeholder="标题" />
            </div>
            <div data-role="fieldcontain">
                <label for="body">
                    备注</label>
                <textarea placeholder="备注" name="body" id="body" style="height: 200px"></textarea>
            </div>
        </div>
    </div>
    <!-- 新增任务列表 -->
    <div id="addTaskListPage" data-role="page" data-theme="a">
        <div data-role="content">
            <form>
            <ul data-role="listview" data-inset="true">
                <li data-role="fieldcontain">
                    <input type="text" placeholder="列表名称" id="tasklistName" name="tasklistName" style="width: 100%" />
                </li>
            </ul>
            <div class="ui-block-b">
                <button id="saveNewTaskList" type="button" data-inline="true" data-theme="a">
                    保存</button>
                <button id="cancelAddTaskList" type="button" data-inline="true" data-theme="a">
                    取消</button>
            </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        $(function () {

            //登录
            $('#loginButton').click(function () {
                validateUser($("#username").val(), $("#password").val(), function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                    else {
                        showPage("taskListPage");
                    }
                });
            });

            //返回任务列表页面
            $('#gotoTasklistImg').click(function () {
                showPage("taskListPage", null, "slide", "reverse");
            });
            //新增任务列表
            $('#addTaskListImg').click(function () {
                $.mobile.changePage("#addTaskListPage", { transition: "pop" });
            });
            //刷新任务列表页面
            $('#refreshTaskListsImg').click(function () {
                showAllTasklist();
            });
            //返回任务页面
            $('#gotoTaskPage').click(function () {
                showPage("taskPage", "listId=" + getCurrentTaskList(), "slide", "reverse");
            });
            //重定向到任务编辑页面
            $('#gotoTaskEditPage').click(function () {
                showPage("taskEditPage", "taskId=" + pageData.taskId);
            });
            //返回任务页面
            $('#gotoTaskPageFromDetailPage').click(function () {
                showPage("taskPage", "listId=" + getCurrentTaskList(), "slide", "reverse");
            });
            //显示新增任务页面
            $('#addTaskImg').click(function () {
                showPage("taskEditPage");
            });
            //刷新任务页面
            $('#refreshTasksImg').click(function () {
                showTasks(getCurrentTaskList());
            });

            //新增任务列表确定按钮响应函数
            $('#saveNewTaskList').click(function () {
                addTaskList($("#tasklistName").val(), function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                    else {
                        showPage("taskListPage", null, "slide", "reverse");
                    }
                });
            });
            //新增任务列表取消按钮响应函数
            $('#cancelAddTaskList').click(function () {
                showPage("taskListPage", null, "slide", "reverse");
            });
            //新增编辑任务确定按钮响应函数
            $('#addOrUpdateTaskButton').click(function () {
                var id = "";
                if (pageData != undefined && pageData.taskId != undefined && pageData.taskId != null) {
                    id = pageData.taskId;
                }

                var subject = $("#subject").val();
                var body = $("#body").val();
                var selectedPriority = $("input[name='priority']:checked");
                var priority = selectedPriority != null ? selectedPriority.val() : 0;
                var dueTime = $("#duetime").val();
                var isCompleted = $("#isCompleted").val();

                addOrUpdateTask(id, subject, body, priority, dueTime, isCompleted, function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                    else {
                        showPage("taskPage", "listId=" + getCurrentTaskList(), "slide", "reverse");
                    }
                });
            });

            //以下三个事件响应函数用户在任务详情页面自动更新用户修改
            $("[name=taskPriority]").change(function () {
                var priority = $('input[name=taskPriority]:checked').val();
                autoUpdateTaskPriority(pageData.taskId, priority, function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                });
            });
            $("#isTaskCompleted").change(function () {
                var isCompleted = $(this).val();
                autoUpdateTaskStatus(pageData.taskId, isCompleted, function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                });
            });
            $("#taskDetailPage #taskDueTime").blur(function () {
                var dueTime = $(this).attr("value");
                autoUpdateTaskDueTime(pageData.taskId, dueTime, function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                });
            });

            //tasklist page event handlers
            $(document).delegate("#taskListPage", "pageinit", function () {
                loadAllTaskList(function (result) {
                    if (!result.success) {
                        alert(result.message);
                    }
                });
            });
            $(document).delegate("#taskListPage", "pagebeforeshow", function () {
                showAllTasklist();
            });

            //task edit page event handlers
            $(document).delegate("#addTaskListPage", "pagebeforeshow", function () {
                $("#tasklistName").val("");
            });

            //task page event handlers
            $(document).delegate("#taskPage", "pagebeforeshow", function () {
                setCurrentTaskList(pageData.listId);
                showTasks(pageData.listId);
            });

            //task detail page event handlers
            $(document).delegate("#taskDetailPage", "pagebeforeshow", function () {
                showTaskOnDetailPage(pageData.taskId);
            });

            //task edit page event handlers
            $(document).delegate("#taskEditPage", "pagebeforeshow", function () {
                clearTaskEditPage();
                if (pageData != undefined && pageData.taskId != undefined && pageData.taskId != null && pageData.taskId != "") {
                    showTaskOnEditPage(pageData.taskId);
                }
            });
        });
    </script>

</body>
</html>
